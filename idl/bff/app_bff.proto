syntax = "proto3";

package bff.app;

option go_package = "bff/app";

import "api.proto";
import "bff/common.proto";

service AppService {

  rpc AddApp(AppAddRequest) returns (BaseResponseLong) {
    option (api.post) = "/app/add";
  }

  rpc DeleteApp(DeleteRequest) returns (BaseResponseBoolean) {
    option (api.post) = "/app/delete";
  }

  rpc UpdateApp(AppUpdateRequest) returns (BaseResponseBoolean) {
    option (api.post) = "/app/update";
  }

  rpc GetAppVOById(GetAppVOByIdRequest) returns (BaseResponseAppVO) {
    option (api.get) = "/app/get/vo";
  }

  rpc ListMyAppVOByPage(AppQueryRequest) returns (BaseResponsePageAppVO) {
    option (api.post) = "/app/my/list/page/vo";
  }

  rpc ListGoodAppVOByPage(AppQueryRequest) returns (BaseResponsePageAppVO) {
    option (api.post) = "/app/good/list/page/vo";
  }

  rpc DeployApp(AppDeployRequest) returns (BaseResponseString) {
    option (api.post) = "/app/deploy";
  }

  rpc DownloadAppCode(DownloadAppCodeRequest) returns (BaseResponseBytes) {
    option (api.get) = "/app/download/:appId";
  }

  rpc ChatToGenCode(ChatToGenCodeRequest) returns (stream ServerSentEventString) {
    option (api.get) = "/app/chat/gen/code";
  }

  // 管理员分页查询聊天记录
  rpc ListAllChatHistoryByPageForAdmin(ChatHistoryQueryRequest) returns (BaseResponsePageChatHistory) {
    option (api.post) = "/chatHistory/admin/list/page/vo";
  }

  // 按应用分页查询聊天记录
  rpc ListAppChatHistory(ListAppChatHistoryRequest) returns (BaseResponsePageChatHistory) {
    option (api.get) = "/chatHistory/app/:appId";
  }

  rpc DeleteAppByAdmin(DeleteRequest) returns (BaseResponseBoolean) {
    option (api.post) = "/app/admin/delete";
  }

  rpc UpdateAppByAdmin(AppAdminUpdateRequest) returns (BaseResponseBoolean) {
    option (api.post) = "/app/admin/update";
  }

  rpc GetAppVOByIdByAdmin(GetAppVOByIdByAdminRequest) returns (BaseResponseAppVO) {
    option (api.get) = "/app/admin/get/vo";
  }

  rpc ListAppVOByPageByAdmin(AppQueryRequest) returns (BaseResponsePageAppVO) {
    option (api.post) = "/app/admin/list/page/vo";
  }
}

message BaseResponseBoolean {
  int32 code = 1;
  bool data = 2;
  string message = 3;
}

message BaseResponseLong {
  int32 code = 1;
  int64 data = 2;
  string message = 3;
}

message BaseResponseString {
  int32 code = 1;
  string data = 2;
  string message = 3;
}

message BaseResponseAppVO {
  int32 code = 1;
  AppVO data = 2;
  string message = 3;
}

message BaseResponsePageAppVO {
  int32 code = 1;
  PageAppVO data = 2;
  string message = 3;
}

message BaseResponsePageChatHistory {
  int32 code = 1;
  PageChatHistory data = 2;
  string message = 3;
}

message BaseResponseBytes {
  int32 code = 1;
  bytes data = 2;
  string message = 3;
}

message ServerSentEventString {
  string d = 1;
  string message = 2;
}


message DeleteRequest {
  int64 id = 1;
}

message AppAddRequest {
  string initPrompt = 1;
}

message AppUpdateRequest {
  int64 id = 1;
  string appName = 2;
}

message AppAdminUpdateRequest {
  int64 id = 1;
  string appName = 2;
  string cover = 3;
  int64 priority = 4;
}

message AppDeployRequest {
  int64 appId = 1;
}

message GetAppVOByIdRequest {
  int64 id = 1 [(api.query) = "id"];
}

message GetAppVOByIdByAdminRequest {
  int64 id = 1 [(api.query) = "id"];
}

message ChatToGenCodeRequest {
  int64 appId = 1 [(api.query) = "appId"];
  string message = 2 [(api.query) = "message"];
}

message DownloadAppCodeRequest {
  int64 appId = 1 [(api.path) = "appId"];
}

message AppQueryRequest {
  int64 pageNum = 1;
  int64 pageSize = 2;
  string sortField = 3;
  string sortOrder = 4;
  int64 id = 5;
  string appName = 6;
  string cover = 7;
  string initPrompt = 8;
  string codeGenType = 9;
  string deployKey = 10;
  int64 priority = 11;
  int64 userId = 12;
}

message ChatHistoryQueryRequest {
  int64 pageNum = 1;
  int64 pageSize = 2;
  string sortField = 3;
  string sortOrder = 4;
  int64 id = 5;
  string message = 6;
  string messageType = 7;
  int64 appId = 8;
  int64 userId = 9;
  string lastCreateTime = 10;
}

message ListAppChatHistoryRequest {
  int64 appId = 1 [(api.path) = "appId"];
  int64 pageSize = 2 [(api.query) = "pageSize"];
  string lastCreateTime = 3 [(api.query) = "lastCreateTime"];
}

message AppVO {
  int64 id = 1;
  string appName = 2;
  string cover = 3;
  string initPrompt = 4;
  string codeGenType = 5;
  string deployKey = 6;
  string deployedTime = 7;
  int64 priority = 8;
  int64 userId = 9;
  string createTime = 10;
  string updateTime = 11;
  UserVO user = 12;
}

message UserVO {
  int64 id = 1;
  string userAccount = 2;
  string userName = 3;
  string userAvatar = 4;
  string userProfile = 5;
  string userRole = 6;
  string createTime = 7;
}

message ChatHistory {
  int64 id = 1;
  string message = 2;
  string messageType = 3;
  int64 appId = 4;
  int64 userId = 5;
  string createTime = 6;
  string updateTime = 7;
  int64 isDelete = 8;
}

message PageAppVO {
  repeated AppVO records = 1;
  int64 pageNumber = 2;
  int64 pageSize = 3;
  int64 totalPage = 4;
  int64 totalRow = 5;
  bool optimizeCountQuery = 6;
}

message PageChatHistory {
  repeated ChatHistory records = 1;
  int64 pageNumber = 2;
  int64 pageSize = 3;
  int64 totalPage = 4;
  int64 totalRow = 5;
  bool optimizeCountQuery = 6;
}
